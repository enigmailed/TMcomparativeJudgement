const images = [
  { id: 1, name: "Series 1", url: "https://drive.google.com/uc?export=view&id=1-PvWDbatFba6-G3E6f7zmbs9l3konivb" },
  { id: 2, name: "Series 2", url: "https://drive.google.com/uc?export=view&id=109ywOjSrdjgBVmo1sy6a5Lg1EVGvk1Ic" },
  { id: 3, name: "Series 3", url: "https://drive.google.com/uc?export=view&id=1sw9LRgKxYPIfdvkOg2mnxcdhWIaFKlGN" },
  { id: 4, name: "Series 4", url: "https://drive.google.com/uc?export=view&id=1tV_1UF7zMPltecCUs8yW5HXUzHkB9DLq" },
  { id: 5, name: "Series 5", url: "https://drive.google.com/uc?export=view&id=1AN7eqCWWCHwZDj-21aKv2aMazz71olPA" }
];

const nameInput = document.getElementById("name");
const emailInput = document.getElementById("email");
const compareDiv = document.getElementById("compare");

let pairs = [];
let current = 0;

function generatePairs() {
  for (let i = 0; i < images.length; i++) {
    for (let j = i + 1; j < images.length; j++) {
      pairs.push([images[i], images[j]]);
    }
  }
  pairs = pairs.sort(() => 0.5 - Math.random()).slice(0, 30);
}

function start() {
  if (!nameInput.value || !emailInput.value) return alert("Fill in both fields.");
  generatePairs();
  document.getElementById("compare").style.display = "block";
  showNextPair();
}

function showNextPair() {
  if (current >= pairs.length) {
    alert("Thanks! You've completed the comparison.");
    return;
  }
  const [a, b] = pairs[current];
  document.getElementById("imgA").src = a.url;
  document.getElementById("imgB").src = b.url;
  document.getElementById("progress").textContent = `Comparison ${current + 1} of ${pairs.length}`;
}

function choose(choice) {
  const [a, b] = pairs[current];
  const winner = choice === "A" ? a : b;

  fetch("https://script.google.com/macros/s/AKfycbzSmkCss3lI4zLMBZ5s7BrrIIeUO_1mjEKmKenpxQYPMXobrepsivVc71L-_lD-Sds1RQ/exec", {
    method: "POST",
    body: JSON.stringify({
      name: nameInput.value,
      email: emailInput.value,
      imageA: a.id,
      imageB: b.id,
      winner: winner.id
    }),
    headers: {
      "Content-Type": "application/json"
    }
  });

  current++;
  showNextPair();
}
